# Выполненые действия

## Подготовка окружения

* За основу взял образ Ubuntu 2204
* Установил в системе docker и docker compose
* При выполнении в папке 01_prometheus `docker compose up -d` разворачивается готовое окружение из вебсервиса, экспортеров, Prometheus и Alert Manager.

### Конфигурация Webapp

Конфигурация приложения описана в файле docker-compose.yml и состоит из публично доступных докер образов.

1. В качестве CMS выбрал Wordpress на базе php-fpm в образе wordpress:fpm.
    Конфигурация php-fpm для контейнера wordpress:fpm находится в файле `config/www.conf`. Строчка `pm.status_path = /status` необходима для работы php-fpm экспортера.
2. В качестве базы данных используется образ MySQL в виде образа mysql:8.
    Данные для аутентификации описаны в переменных окружения контейнера.
3. В качестве вебсервера используется Nginx образ nginx:alpine.
    Конфигурация nginx описана в файле `config/default.conf`

### Конфигурация экспортеров

1. Контейнер с node exporter используется для сбора данных виртуальной машины. Контейнер сконфигурирован для доступа в систему на чтение.
2. Контейнер с nginx exporter используется для извлечения метрик nginx. Для этого в настройках nginx включена функция вывода stub_status вебсервера.
3. Контейнер с mysqld exporter используется для сбора данных MySQL. Подключение к базе в примере происходит от root пользователя, в реальном случае лучше создать отдельного пользователя для сбора метрик.
4. Контейнер с php-fpm exporter собирает данные с CMS, подключаясь к 9000 порту контейнера wordpress на котором fpm выводит свои метрики.
5. Контейнер с blackbox exporter проверяет доступность HTTP сервиса извне. Файл конфигурации описан в `config/blackbox.yml`

### Конфигурация Prometheus

Prometheus разворачивается из образа prometheus:latest. Конфигурация находится по пути `GAP-1/prometheus.yml`. Также вольюмом подключается ключ `ssl/fullchain.pem` необходимый для работы c SSL на эндпоинтах экспортеров.

### Конфигурация Alertmanager

Alertmanager разворачивается из образа alertmanager:latest. Конфигурация находится по пути `GAP-1/alertmanager.yml`

### Задание со звёздочкой

Все экспортеры работают через nginx на 8443 порту c шифрованием (сертификаты в примере самоподписанные для 127.0.0.1 и находятся в `ssl/`), каждый на своём эндпоинте. Для авторизации на этом порту используется механизм Basic Auth nginx c логином prometheus, паролем prometheus. Файл с хешем для работы конфигурации находится по пути `config/htpasswd`. Конфигурация эндпоинтов описана в `config/default.conf`
